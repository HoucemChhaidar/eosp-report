\section{Sprint 3 – Credit Management}

In this section, we first detail the Sprint 3 backlog, then present the design and implementation of features through screenshots and diagrams.

\subsection{Sprint 3 Backlog}

\begin{table}[!htbp]
  \centering
  \small
  \caption{Sprint 3 Backlog} 
  \label{tab:backlog_sprint3}
  \renewcommand{\arraystretch}{1.2}
  \begin{tabular}{|p{1cm}|p{4cm}|p{7cm}|p{2cm}|}
    \hline
    \textbf{ID} & \textbf{User Story}               & \textbf{Description}                                                                                             & \textbf{Priority} \\ \hline
    US7         & Distribute bulk credit to Admin & As a Super Admin, I want to distribute bulk credit to an Admin after they provide cash at ASM to enable their organizational payment capabilities. & High            \\ \hline
    US8         & Distribute credit across users       & As an Admin, I want to distribute received credit across end users to enable their payment capabilities. & Critical         \\ \hline
  \end{tabular}
\end{table}

\subsection{Use Case Diagram}

Figure~\ref{fig:uc_sprint3} presents the two major use cases developed during Sprint 3: Super Admin distributing bulk credit to Admin and Admin distributing credit across users. It illustrates their respective interactions with the \textit{Super Admin} and \textit{Admin} actors and the authentication system.

\begin{figure}[H]
   \centering
  \includegraphics[width=0.8\textwidth]{images/usecase_sprint3.png}
  \caption{Use Case Diagram – Sprint 3}
  \label{fig:uc_sprint3}
\end{figure}

\subsection{Use Case Descriptions – Sprint 3}

In this section, we detail each use case identified for Sprint 3.

\subsubsection{Use Case "Distribute bulk credit per admin"}

\begin{longtable}{|p{0.2\textwidth}|p{0.75\textwidth}|}
  \caption{Description of use case "Distribute bulk credit per admin"}
  \label{tab:uc_distribute_bulk_credit_admin} \\
  \hline
  \textbf{Title} & Distribute bulk credit per admin \\ \hline
  \textbf{Actors} & Super Admin \\ \hline
  \textbf{Description} & The Super Admin distributes bulk credit to an Admin after the Admin provides cash payment at ASM (physical location). This process involves balance verification and transaction processing through the web application. \\ \hline
  \textbf{Preconditions} & 
    \begin{itemize}[nosep,leftmargin=*]
      \item The Super Admin is authenticated with valid credentials.
      \item The Admin has provided cash payment at ASM.
      \item Super Admin has sufficient balance to distribute.
      \item Transaction controller is operational for processing.
    \end{itemize} \\ \hline
  \textbf{Postconditions} & 
    \begin{itemize}[nosep,leftmargin=*]
      \item Bulk credit is distributed and added to Admin balance.
      \item Transaction record is created with distribution details.
      \item Super Admin receives confirmation of successful distribution.
      \item Admin receives notification of credit allocation.
    \end{itemize} \\ \hline
  \textbf{Main Scenario} &
    \begin{enumerate}[nosep,leftmargin=*]
      \item Admin provides cash payment at ASM physical location.
      \item Super Admin logs into the web application.
      \item Super Admin selects "Distribute Credit to Admin" option.
      \item System displays Admin selection form with amount input.
      \item Super Admin selects target Admin and enters credit amount.
      \item System validates Super Admin balance sufficiency.
      \item Transaction controller processes credit distribution.
      \item System updates Super Admin and Admin balances.
      \item Super Admin receives success confirmation message.
      \item Admin receives credit allocation notification.
    \end{enumerate} \\ \hline
  \textbf{Alternative Scenarios} &
    \begin{enumerate}[nosep,leftmargin=*]
      \item If Super Admin modifies amount, recalculate and revalidate balance.
      \item If Admin is not found, display Admin selection error.
    \end{enumerate} \\ \hline
  \textbf{Exception Scenarios} &
    \begin{enumerate}[nosep,leftmargin=*]
      \item If insufficient Super Admin balance, display "Not enough balance, credit distribution cancelled".
      \item If transaction processing fails, show "Distribution failed, please retry".
      \item If Admin account is inactive, display "Cannot distribute to inactive Admin".
      \item If network timeout occurs, display "Connection error, please retry".
    \end{enumerate} \\ \hline
\end{longtable}

\subsubsection{Use Case "Distribute credit across users"}

\begin{longtable}{|p{0.2\textwidth}|p{0.75\textwidth}|}
  \caption{Description of use case "Distribute credit across users"}
  \label{tab:uc_distribute_credit} \\
  \hline
  \textbf{Title} & Distribute credit across users \\ \hline
  \textbf{Actors} & Admin \\ \hline
  \textbf{Description} & Admin distributes received credit to end users within their organization, with balance validation and transaction processing. \\ \hline
  \textbf{Preconditions} & 
    \begin{itemize}[nosep,leftmargin=*]
      \item Admin is authenticated and has sufficient credit balance.
      \item End users are registered within the organization.
      \item Transaction controller is operational for processing.
    \end{itemize} \\ \hline
  \textbf{Postconditions} & 
    \begin{itemize}[nosep,leftmargin=*]
      \item Credit is successfully distributed to selected end users.
      \item Admin balance is reduced by distributed amount.
      \item End users receive credit allocation notifications.
    \end{itemize} \\ \hline
  \textbf{Main Scenario} &
    \begin{enumerate}[nosep,leftmargin=*]
      \item Admin selects "Distribute Credit" option.
      \item System displays list of end users and distribution form.
      \item Admin selects end users and specifies credit amounts.
      \item System validates Admin balance sufficiency.
      \item Transaction controller processes credit distribution.
      \item System updates Admin balance and end user balances.
      \item Admin receives success confirmation message.
    \end{enumerate} \\ \hline
  \textbf{Alternative Scenarios} &
    \begin{enumerate}[nosep,leftmargin=*]
      \item If Admin modifies distribution, recalculate totals.
      \item If partial distribution succeeds, show successful and failed allocations.
    \end{enumerate} \\ \hline
  \textbf{Exception Scenarios} &
    \begin{enumerate}[nosep,leftmargin=*]
      \item If insufficient balance, display "Not enough balance, credit distribution cancelled".
      \item If transaction processing fails, show "Distribution failed, please retry".
      \item If end user account is inactive, skip and notify Admin.
    \end{enumerate} \\ \hline
\end{longtable}

\subsection{Sequence Diagrams}

\subsubsection{Sequence Diagram - Distribute Bulk Credit to Admin}

This diagram (see figure \ref{fig:seq_distribute_credit_admin}) models the bulk credit distribution process from Super Admin to Admin after cash payment at ASM:

\begin{itemize}[nosep,leftmargin=*]
  \item Super Admin initiates credit distribution request after Admin provides cash at ASM.
  \item System validates Super Admin balance sufficiency.
  \item Transaction controller processes the credit distribution.
  \item System updates both Super Admin and Admin balances.
  \item Super Admin receives success confirmation or error message.
\end{itemize}

\begin{figure}[H] 
  \centering
  \includegraphics[width=0.9\textwidth,keepaspectratio]{images/seq_distribute_credit_to_admin.png}
  \caption{Sequence Diagram "Distribute Bulk Credit to Admin"}
  \label{fig:seq_distribute_credit_admin}
\end{figure}

\subsubsection{Sequence Diagram - Distribute Credit Across Users}

This diagram (see figure \ref{fig:seq_distribute_credit}) shows the credit distribution process with balance validation:

\begin{itemize}[nosep,leftmargin=*]
  \item Admin requests to distribute credits to end users.
  \item System validates Admin balance sufficiency.
  \item Transaction controller processes the credit distribution.
  \item System updates balances and provides success confirmation.
\end{itemize}

\begin{figure}[H] 
  \centering
  \includegraphics[width=0.9\textwidth,keepaspectratio]{images/seq_distribute_credit_across_users.png}
  \caption{Sequence Diagram "Distribute Credit Across Users"}
  \label{fig:seq_distribute_credit}
\end{figure}

\subsection{Realization (Sprint 3)}

In this section, we present the main interfaces developed during Sprint 3, dedicated to credit management functionality. This work involved implementing Super Admin credit distribution to Admins and Admin credit distribution to end users. Each interface is illustrated with screenshots and accompanied by descriptions of functionality and user journey.

\subsubsection{Super Admin Credit Distribution Interface}

The Super Admin credit distribution interface enables Super Admins to allocate credit to Admins after they provide cash payment at ASM. This interface is accessed through the wallet management view.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.9\textwidth]{images/web_wallets_list}
  \caption{Super Admin Credit Distribution Interface - Wallet Management View}
  \label{fig:sprint3_superadmin_distribution_interface}
\end{figure}

— \textbf{States presented:}
\begin{itemize}[nosep,leftmargin=*,label=•]
  \item \textbf{Admin selection}  
    Dropdown list of all Admins with their current balance display.
  \item \textbf{Amount input}  
    Input field for specifying credit amount to distribute.
  \item \textbf{Balance validation}  
    Real-time validation of sufficient Super Admin balance.
  \item \textbf{Distribution confirmation}  
    Summary and confirmation of credit distribution to Admin.
\end{itemize}

— \textbf{Credit distribution flow:}
\begin{itemize}[nosep,leftmargin=*,label=•]
  \item Admin provides cash payment at ASM physical location.
  \item Super Admin is authenticated and accesses distribution interface.
  \item Super Admin selects target Admin from dropdown list.
  \item Super Admin enters credit amount corresponding to cash received.
  \item System validates sufficient Super Admin balance for distribution.
  \item Upon confirmation, credit is distributed and both balances are updated.
\end{itemize}

\subsubsection{Credit Distribution Dashboard}

The credit distribution dashboard enables Admins to allocate received credit across their end users.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.9\textwidth]{images/web_distribute_credit_users}
  \caption{Credit Distribution Dashboard - Admin to Users Distribution}
  \label{fig:sprint3_distribution_interface}
\end{figure}

— \textbf{States presented:}
\begin{itemize}[nosep,leftmargin=*,label=•]
  \item \textbf{End user list}  
    Display of all end users within the organization.
  \item \textbf{Credit allocation}  
    Input fields for specifying credit amounts per user.
  \item \textbf{Balance validation}  
    Real-time validation of sufficient Admin balance.
  \item \textbf{Distribution confirmation}  
    Summary and confirmation of credit distribution.
\end{itemize}

— \textbf{Credit distribution flow:}
\begin{itemize}[nosep,leftmargin=*,label=•]
  \item Admin accesses distribution dashboard.
  \item System displays list of end users and current balances.
  \item Admin specifies credit amounts for selected end users.
  \item System validates sufficient Admin balance for distribution.
  \item Upon confirmation, credits are distributed and balances updated.
\end{itemize}
