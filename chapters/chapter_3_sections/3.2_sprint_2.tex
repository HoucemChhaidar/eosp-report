\section{Sprint 2 - Transaction Management}

\subsection{Sprint 2 Backlog}

The second sprint focuses on implementing transaction management capabilities for the Credix mobile payment application. This sprint enables end users to view their wallet balance, transaction history, available stores, generate time-bound barcodes for payments, and receive real-time transaction confirmations. The following table presents the user stories prioritized for this sprint:

\begin{table}[!htbp]
  \centering
  \small
  \caption{Sprint 2 Backlog - Transaction Management}
  \label{tab:sprint2_backlog}
  \begin{tabular}{|p{1.5cm}|p{4cm}|p{6.5cm}|p{2cm}|}
    \hline
    \textbf{ID} & \textbf{User Story} & \textbf{Description} & \textbf{Priority} \\ \hline
    US4 & Generate Time-bound Barcode  
      & As an end user, I want to generate a secure, time-bound barcode containing my wallet's tokenizedId for payment processing.  
      & Critical \\ \hline
    US5 & View Real-time Transaction Confirmation  
      & As an end user, I want to receive immediate confirmation and detailed information about completed payment transactions.  
      & Critical \\ \hline
    US6 & View Balance  
      & As an end user, I want to view my current wallet balance with real-time updates and refresh capabilities.  
      & High \\ \hline
    US7 & View Transactions History  
      & As an end user, I want to access my complete transaction history with filtering and search capabilities.  
      & High \\ \hline
    US8 & View Stores  
      & As an end user, I want to view a list of stores where I can use my wallet for payments, including store details and locations.  
      & Medium \\ \hline
  \end{tabular}
\end{table}

\subsection{Use Case Diagram}

The following diagram illustrates the main use cases implemented during Sprint 2, showing the interactions between End Users and the transaction management system, focusing on wallet balance viewing, transaction history, store listings, barcode generation, and real-time transaction confirmation.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{images/usecase_sprint2.png}
\caption{Sprint 2 Use Case Diagram - Transaction Management}
\label{fig:sprint2_usecase_diagram}
\end{figure}

\subsection{Use Case Descriptions}

\subsubsection{UC4: Generate Time-bound Barcode}

\begin{longtable}{|p{3cm}|p{11cm}|}
\hline
\textbf{Use Case ID} & UC4 \\
\hline
\textbf{Use Case Name} & Generate Time-bound Barcode \\
\hline
\textbf{Description} & This use case allows end users to generate a secure, time-bound barcode containing their wallet's tokenizedId for payment processing. \\
\hline
\textbf{Primary Actor} & End User \\
\hline
\textbf{Secondary Actor} & Wallet System, Barcode Generator \\
\hline
\textbf{Preconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item End user is authenticated and has access to their wallet
\item Wallet exists and is active in the system
\end{itemize} \\
\hline
\textbf{Postconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item Time-bound barcode is generated using wallet's tokenizedId
\item Barcode expires after a set time period for security
\item User can regenerate barcode as needed
\end{itemize} \\
\hline
\textbf{Main Flow} & 
\begin{enumerate}[nosep,leftmargin=*]
\item End user opens wallet application and navigates to payment section
\item User selects "Generate Payment Barcode" option
\item System retrieves user's wallet tokenizedId from database
\item System generates barcode encoding the tokenizedId
\item System displays barcode on screen with countdown timer
\item Barcode automatically expires after the time limit for security
\item User can regenerate new barcode if needed
\end{enumerate} \\
\hline
\textbf{Alternative Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{A1:} Barcode expires - User can generate new barcode immediately
\item \textbf{A2:} Multiple payment attempts - User can generate multiple barcodes in sequence
\end{itemize} \\
\hline
\textbf{Exception Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{E1:} Wallet not found - System displays error and redirects to wallet setup
\item \textbf{E2:} Network connectivity issues - System displays cached wallet information with warning
\item \textbf{E3:} Insufficient balance - System displays balance warning but still generates barcode
\end{itemize} \\
\hline
\end{longtable}

\subsubsection{UC5: View Real-time Transaction Confirmation}

\begin{longtable}{|p{3cm}|p{11cm}|}
\hline
\textbf{Use Case ID} & UC5 \\
\hline
\textbf{Use Case Name} & View Real-time Transaction Confirmation \\
\hline
\textbf{Description} & This use case provides end users with immediate confirmation and detailed information about completed payment transactions. \\
\hline
\textbf{Primary Actor} & End User \\
\hline
\textbf{Secondary Actor} & Transaction System \\
\hline
\textbf{Preconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item User has initiated a payment transaction
\item Payment processing is in progress
\end{itemize} \\
\hline
\textbf{Postconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item User receives immediate transaction confirmation
\item Wallet balance is updated in real-time
\item Transaction is recorded in user's history
\end{itemize} \\
\hline
\textbf{Main Flow} & 
\begin{enumerate}[nosep,leftmargin=*]
\item User initiates a payment transaction
\item System processes payment through the transaction controller
\item System validates transaction and updates wallet balance
\item User receives real-time notification of successful payment
\item System displays transaction confirmation with details (amount, timestamp, store, balance)
\item User can view digital receipt immediately
\end{enumerate} \\
\hline
\textbf{Alternative Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{A1:} Slow network connection - System shows processing indicator
\item \textbf{A2:} Partial payment - System handles split transactions
\end{itemize} \\
\hline
\textbf{Exception Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{E1:} Payment declined - System displays reason and suggests alternatives
\item \textbf{E2:} Network timeout - System queues transaction for retry
\item \textbf{E3:} Insufficient funds - System displays balance error and cancels transaction
\end{itemize} \\
\hline
\end{longtable}

\subsubsection{UC6: View Balance}

\begin{longtable}{|p{3cm}|p{11cm}|}
\hline
\textbf{Use Case ID} & UC6 \\
\hline
\textbf{Use Case Name} & View Balance \\
\hline
\textbf{Description} & This use case allows end users to view their current wallet balance with real-time updates and refresh capabilities. \\
\hline
\textbf{Primary Actor} & End User \\
\hline
\textbf{Secondary Actor} & Wallet System, Database \\
\hline
\textbf{Preconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item User is authenticated and has access to wallet
\item Wallet exists and is active in the system
\end{itemize} \\
\hline
\textbf{Postconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item Current wallet balance is displayed accurately
\item Balance information is refreshed from server
\item User has visibility into available funds
\end{itemize} \\
\hline
\textbf{Main Flow} & 
\begin{enumerate}[nosep,leftmargin=*]
\item User opens wallet application home screen
\item System automatically retrieves current wallet balance
\item System displays balance prominently on home interface
\item User can refresh to update balance manually
\item System shows last updated timestamp for transparency
\item Balance updates automatically after transactions
\end{enumerate} \\
\hline
\textbf{Alternative Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{A1:} Offline mode - System displays last cached balance with indicator
\item \textbf{A2:} Multiple currency support - System displays balance in preferred currency
\end{itemize} \\
\hline
\textbf{Exception Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{E1:} Balance retrieval failure - System displays cached balance with error indicator
\item \textbf{E2:} Wallet suspended - System displays suspension notice
\end{itemize} \\
\hline
\end{longtable}

\subsubsection{UC7: View Transactions History}

\begin{longtable}{|p{3cm}|p{11cm}|}
\hline
\textbf{Use Case ID} & UC7 \\
\hline
\textbf{Use Case Name} & View Transactions History \\
\hline
\textbf{Description} & This use case provides end users with comprehensive access to their complete transaction history with filtering and search capabilities. \\
\hline
\textbf{Primary Actor} & End User \\
\hline
\textbf{Secondary Actor} & Transaction System, Database \\
\hline
\textbf{Preconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item User is authenticated and has wallet access
\item User has performed at least one transaction (or none for empty state)
\end{itemize} \\
\hline
\textbf{Postconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item Complete transaction history is displayed chronologically
\item User can access detailed information for each transaction
\item Transaction data is properly formatted and searchable
\end{itemize} \\
\hline
\textbf{Main Flow} & 
\begin{enumerate}[nosep,leftmargin=*]
\item User navigates to "Transaction History" from main menu
\item System retrieves all transactions associated with user's wallet
\item System displays transactions in reverse chronological order
\item Each transaction shows: date, amount, store, status, and type
\item User can tap on any transaction to view detailed information
\item Detailed view includes: transaction ID, timestamp, description, receipt
\item User can filter transactions by date range, amount, or store
\item User can search transactions using keywords
\end{enumerate} \\
\hline
\textbf{Alternative Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{A1:} No transactions - System displays empty state with helpful guidance
\item \textbf{A2:} Large transaction history - System implements pagination for performance
\item \textbf{A3:} Export functionality - User can export transaction history as PDF/CSV
\item \textbf{A4:} Print receipt - User can print individual transaction receipts
\end{itemize} \\
\hline
\textbf{Exception Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{E1:} Data loading failure - System displays cached transactions with sync indicator
\item \textbf{E2:} Corrupted transaction data - System displays available information with error notice
\item \textbf{E3:} Network timeout - System shows retry option with offline data
\end{itemize} \\
\hline
\end{longtable}

\subsubsection{UC8: View Stores}

\begin{longtable}{|p{3cm}|p{11cm}|}
\hline
\textbf{Use Case ID} & UC8 \\
\hline
\textbf{Use Case Name} & View Stores \\
\hline
\textbf{Description} & This use case allows end users to view a list of stores where they can use their wallet for payments, including store details and locations. \\
\hline
\textbf{Primary Actor} & End User \\
\hline
\textbf{Secondary Actor} & Store System, Database \\
\hline
\textbf{Preconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item User is authenticated and has wallet access
\item Store data is available in the system
\end{itemize} \\
\hline
\textbf{Postconditions} & 
\begin{itemize}[nosep,leftmargin=*]
\item List of stores is displayed to the user
\item User can view store details including name, type, and location
\item User can navigate to store locations
\end{itemize} \\
\hline
\textbf{Main Flow} & 
\begin{enumerate}[nosep,leftmargin=*]
\item User navigates to "Stores" from main menu
\item System retrieves list of available stores from database
\item System displays stores with name, description, and type
\item User can view store details including location (latitude, longitude)
\item User can filter stores by type (Retail, Restaurant, Cafe, Clothing, Grocery, Pharmacy, Electronics, Bookstore, Gas Station, Bakery)
\item User can search for specific stores by name
\item User can view store location on map
\end{enumerate} \\
\hline
\textbf{Alternative Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{A1:} No stores available - System displays empty state with message
\item \textbf{A2:} Location services enabled - System shows nearby stores first
\item \textbf{A3:} Favorite stores - User can mark stores as favorites for quick access
\end{itemize} \\
\hline
\textbf{Exception Flow} & 
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{E1:} Data loading failure - System displays cached store list with sync indicator
\item \textbf{E2:} Network timeout - System shows retry option with offline data
\end{itemize} \\
\hline
\end{longtable}

\subsection{Sequence Diagrams}

\subsubsection{View Balance Sequence Diagram}

This diagram illustrates the process of retrieving and displaying wallet balance. The end user requests balance information through the home interface, which communicates with the wallet controller to fetch current balance data from the wallet entity and display it to the user.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{images/seq_view_balance.png}
\caption{View Balance Sequence Diagram}
\label{fig:seq_view_balance}
\end{figure}

\subsubsection{View Transactions Sequence Diagram}

This diagram shows the transaction history retrieval process. The end user requests transaction history through the transactions interface, which communicates with the transaction controller to fetch transaction data from the transaction entity and display the chronological list to the user.

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{images/seq_view_transactions.png}
\caption{View Transactions Sequence Diagram}
\label{fig:seq_view_transactions}
\end{figure}

\subsection{Class Diagram (Sprint 2)}

The Sprint 2 class diagram extends the foundational entities from Sprint 1 with transaction management and store listing capabilities. The diagram shows the relationships between User hierarchy (Super Admin, Admin, End User), Wallet, Transaction, Store entities, and their associated enums (TransactionType, TransactionStatus, StoreType).

Key additions in Sprint 2:
\begin{itemize}[nosep,leftmargin=*]
\item \textbf{Transaction}: Records wallet transactions with amount, description, timestamp, type, and status
\item \textbf{TransactionType}: Enum defining CREDIT and DEBIT transaction types
\item \textbf{TransactionStatus}: Enum defining transaction states (PENDING, COMPLETED, FAILED, REFUNDED)
\item \textbf{Store}: Represents merchant locations with name, description, location coordinates, and type
\item \textbf{StoreType}: Enum defining store categories (RETAIL, RESTAURANT, CAFE, CLOTHING, GROCERY, PHARMACY, ELECTRONICS, BOOKSTORE, GAS\_STATION, BAKERY)
\end{itemize}

\begin{figure}[H]
\centering
\includegraphics[width=0.9\textwidth]{images/class_sprint2.png}
\caption{Class Diagram - Sprint 2}
\label{fig:class_sprint2}
\end{figure}

\subsection{Realization (Sprint 2)}

This section presents the actual implementation of Sprint 2 use cases through the developed mobile application interfaces. Each interface is illustrated with screenshots and accompanied by functionality descriptions.

\subsubsection{Wallet Balance Interface}

The wallet balance interface displays the current balance prominently on the home screen with real-time updates and refresh functionality.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.35\textwidth]{images/mobile_home}
  \caption{Wallet Balance Interface - Mobile Home Screen}
  \label{fig:sprint2_balance_interface}
\end{figure}

— \textbf{Key Features:}
\begin{itemize}[nosep,leftmargin=*,label=•]
\item Prominent balance display on home screen
\item Real-time balance updates after transactions
\item Manual refresh functionality
\item Last updated timestamp for transparency
\item Offline mode with cached balance indicator
\end{itemize}

\subsubsection{Transaction History Interface}

The transaction history interface provides comprehensive transaction management with chronological listing, detailed transaction information, and the ability to print transaction receipts.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.35\textwidth]{images/mobile_transactions}
  \caption{Transaction History Interface - Mobile View}
  \label{fig:sprint2_transactions_interface}
\end{figure}

— \textbf{Key Features:}
\begin{itemize}[nosep,leftmargin=*,label=•]
\item Chronological transaction listing
\item Detailed transaction information (date, amount, store, status, type)
\item Filtering by date range, amount, or store
\item Search functionality using keywords
\item Print receipt capability for individual transactions
\item Export functionality (PDF/CSV)
\end{itemize}

\subsubsection{Barcode Generation Interface}

The barcode generation interface provides secure, time-bound payment codes using the wallet's tokenizedId with an expiry timer for security.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.35\textwidth]{images/mobile_barcode}
  \caption{Barcode Generation Interface - Time-bound Payment Code}
  \label{fig:sprint2_barcode_interface}
\end{figure}

— \textbf{Key Features:}
\begin{itemize}[nosep,leftmargin=*,label=•]
\item Time-bound barcode generation using wallet tokenizedId
\item Countdown timer showing barcode expiry
\item Automatic expiration for security
\item Regeneration option for new barcodes
\item Balance warning display if insufficient funds
\end{itemize}

\subsubsection{Real-time Transaction Confirmation Interface}

The transaction confirmation interface provides immediate feedback on completed payments with detailed transaction information.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.35\textwidth]{images/mobile_transaction_success}
  \caption{Real-time Transaction Confirmation Interface}
  \label{fig:sprint2_confirmation_interface}
\end{figure}

— \textbf{Key Features:}
\begin{itemize}[nosep,leftmargin=*,label=•]
\item Immediate transaction confirmation notification
\item Detailed transaction information (amount, timestamp, store, balance)
\item Real-time wallet balance update
\item Digital receipt viewing capability
\item Processing indicator for slow connections
\end{itemize}

\subsubsection{Stores Listing Interface}

The stores interface displays a list of available merchant locations where users can make payments, with filtering and search capabilities.

\begin{figure}[H]
  \centering
  \includegraphics[width=0.35\textwidth]{images/mobile_stores}
  \caption{Stores Listing Interface - Mobile View with Filtering}
  \label{fig:sprint2_stores_interface}
\end{figure}

— \textbf{Key Features:}
\begin{itemize}[nosep,leftmargin=*,label=•]
\item List of stores with name, description, and type
\item Store type filtering (Retail, Restaurant, Cafe, Clothing, Grocery, Pharmacy, Electronics, Bookstore, Gas Station, Bakery)
\item Search functionality by store name
\item Location information (latitude, longitude)
\item Map integration for store locations
\item Favorite stores marking capability
\end{itemize}
